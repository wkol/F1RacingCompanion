package com.example.f1racingcompanion.data

import androidx.arch.core.executor.testing.InstantTaskExecutorRule
import com.example.f1racingcompanion.api.LiveTimingService
import com.example.f1racingcompanion.utils.DateParser
import com.example.f1racingcompanion.utils.FlowStreamAdapter
import com.example.f1racingcompanion.utils.LiveTimingDataParser
import com.example.f1racingcompanion.utils.PreviousDataParser
import com.serjltt.moshi.adapters.FirstElement
import com.serjltt.moshi.adapters.Wrapped
import com.squareup.moshi.Moshi
import com.squareup.moshi.kotlin.reflect.KotlinJsonAdapterFactory
import com.tinder.scarlet.Scarlet
import com.tinder.scarlet.messageadapter.moshi.MoshiMessageAdapter
import com.tinder.scarlet.websocket.ShutdownReason
import com.tinder.scarlet.websocket.WebSocketEvent
import com.tinder.scarlet.websocket.okhttp.OkHttpWebSocket
import io.fabric8.mockwebserver.DefaultMockServer
import kotlinx.coroutines.ExperimentalCoroutinesApi
import kotlinx.coroutines.flow.first
import kotlinx.coroutines.flow.take
import kotlinx.coroutines.flow.toList
import kotlinx.coroutines.runBlocking
import okhttp3.OkHttpClient
import okhttp3.Request
import org.junit.After
import org.junit.Assert.assertEquals
import org.junit.Assert.assertTrue
import org.junit.Before
import org.junit.Rule
import org.junit.Test

@ExperimentalCoroutinesApi
class LiveTimingRepositoryTest {
    private lateinit var moshi: Moshi

    private lateinit var server: DefaultMockServer

    private val url by lazy { server.url("/test") }

    private lateinit var service: LiveTimingService

    @get:Rule
    val instantExecutorRule = InstantTaskExecutorRule()

    @Before
    fun setUpMockWebSocket() {
        server = DefaultMockServer()
        moshi = Moshi.Builder().add(Wrapped.ADAPTER_FACTORY).add(FirstElement.ADAPTER_FACTORY).add(PreviousDataParser.Factory)
            .add(LiveTimingDataParser.Factory).add(DateParser()).add(KotlinJsonAdapterFactory())
            .build()
        server.start()
        val okHttpClient = OkHttpClient.Builder().build()
        val protocol = OkHttpWebSocket(
            okHttpClient,
            OkHttpWebSocket.SimpleRequestFactory(
                { Request.Builder().url(url).build() },
                { ShutdownReason.GRACEFUL }
            )
        )
        val config = Scarlet.Configuration(
            messageAdapterFactories = listOf(MoshiMessageAdapter.Factory(moshi)),
            streamAdapterFactories = listOf(FlowStreamAdapter.Factory())
        )
        val scarletInstance = Scarlet(protocol, config)
        service = scarletInstance.create()
    }

    @After
    fun stopServer() = server.shutdown()

    @Test
    fun openAndCloseEvents_connectingToServer() = runBlocking {
        // Given a set up repository and a mocked webSocket server
        val repository = LiveTimingRepository(service)
        server.expect().withPath("/test")
            .andUpgradeToWebSocket()
            .open()
            .done()
            .once()

        // When starting a webSocketConnection
        val events = repository.startWebSocket().take(2).toList()

        // Then the repository opens and closes connection
        assertTrue(events[0] is WebSocketEvent.OnConnectionOpened)
        assertTrue(events[1] is WebSocketEvent.OnConnectionClosing)
    }

    @Test
    fun getTimingStats() = runBlocking {
        val repository = LiveTimingRepository(service)
        val message = "{\"C\":\"7,1299\",\"M\":[{\"H\":\"Streaming\",\"M\":\"feed\",\"A\":" +
            "[\"TimingStats\", {\"Lines\": {\"5\": {\"BestSpeeds\": {\"ST\": {\"Value\": \"260\"}}}," +
            "\"16\": {\"BestSpeeds\": {\"ST\": {\"Position\": 2, \"Value\": \"293\"}}}}}, \"2021-10-08T08:34:53.943Z\"]}]}"
        server.expect().withPath("/test")
            .andUpgradeToWebSocket()
            .open()
            .waitFor(0).andEmit(message)
            .done()
            .once()

        val element = repository.getTimingStats().first()

        assertEquals(element.date!!.dayOfMonth, 8)
        assertEquals(element.date!!.second, 53)
        assertEquals(element.date!!.minute, 34)
        assertEquals(element.data!!.lines[5]!!.bestSpeeds!!["ST"]!!.value, "260")
    }

    @Test
    fun getTimingData() = runBlocking {
        val repository = LiveTimingRepository(service)
        val message =
            "{\"C\":\"d-16F253A7-B,0|MNW,0|MNX,11|BG,EB|BM,DA0|BL,DA0|F,2|S,3A|GU,0|BK,1DB|R,121|P,3B|Q,5|6,46|BI,15|BD,1|BO,6|N,0|7,1299\",\"M\":[{\"H\":\"Streaming\",\"M\":\"feed\",\"A\":[\"TimingData\",{\"Lines\":{\"16\":{\"Speeds\":{\"ST\":{\"Value\":\"290\"}}}}},\"2021-10-23T08:34:53.834Z\"]}]}"
        server.expect().withPath("/test")
            .andUpgradeToWebSocket()
            .open()
            .waitFor(0).andEmit(message)
            .done()
            .once()

        val element = repository.getTimingData().first()
        assertEquals(element.date!!.dayOfMonth, 23)
        assertEquals(element.date!!.second, 53)
        assertEquals(element.date!!.minute, 34)
        assertEquals(element.data!!.lines[16]!!.speeds!!["ST"]!!.value, "290")
    }

    @Test
    fun getDriverTelemetry() = runBlocking {
        val repository = LiveTimingRepository(service)
        val message =
            "{\"C\":\"d-BAF194C6-B,0|QI,0|QJ,11|BM,171|BT,155C|BS,155B|F,5|k,32D|Ml,0|BR,349|j,17B|h,5C|i,3|BO,57|BP,17|BJ,1|BV,16|f,12|BW,43F6\",\"M\":[{\"H\":\"Streaming\",\"M\":\"feed\",\"A\":[\"CarData.z\",\"xZjBbtw4DIbfxedJQVKiSM612DfYXlrsoVgE2AUWOXR7C/LutSWqcGJ67FEOuWQQw79EU+RHUs/TH08/f/z7+P90/fY8ffn593SdCAgfEB4o/4l2TelK9slEiqF9nS7T5+8/5refp7T8+fzP96enx//qA5iuCJLSZaLpSiVfllfkMuXpanqZeLrC/M/y8/JSn27lCLnJMWGVU31R0kbOgdwwaVUrVDFWMW/FJRAX4LQWpyom3oglEIui2124qktVQxUjuFwXucVu02Y5mVW9Vn1VvtkeIVgAqrgZDi7NvnluYqxiDL2eF28vu2dZWR/uHh+bmp+6HxvvLxD5HpG4tAWgrBZYnPFWr7Ee/AuWCLj5BUSxC9APAOTgC1LkQ4HcDNC8ittAHGYNZlcT2sHuOTqAwmQt/KB9fo7Cr+mj8FVa4rymnR3oOUo8RLYeQUf+L5EHjKW5HzWtHFBkm32R/fP5mwTx82Z/pJqAUQZqBmoGYFml/9YD8wq7nEzwiVAKs5zgJHdOygAnwTxgMK9ppXiKk4qebWIrTuZtsoWcTNBiTWnNya045GSR7HbbGCeLOSf1AzhZsFlPTGOctL5AymOc5OQLIAxxMhfnbE5jnFTPk0qM+zlZ1EmlOMJJQfDdj/wXcpIVmvvsCHMhJo08aZHKGCZF4GQAxZhU9LTXNeYkn8WklF5nxjApZl4owN6DycxS5ufHmNSeMEOYnMuZ10XOa0yWc5jMOWont84OMdkbCuXVzvlkO8ns1egVJ+7ApKSPxKT67sxjmCzFm7EUNWOvM20HlMk6KNMWlG9WiFFZUE42xTEqqQ8UlGAIlbk0A0RGUNlRcbx7jMrsmW5prKP0CET3/x4o9lAJWXutPapUISrnF8ktsCMH7MDS+kxGNAZL9mqDQO+BZTFhzeUELLPX5qIjPSV7b4U+uue93iKcvUkogOWWd1G6CnhdtLWjgsE9hKWk4lWZN6F6pqOUj0Ml2G9UHs1NO6iEbv6ryfE8KOdT75P34QI7nDw9+sWcBLVysimOOVlHdmpt0N2chMI+UaQjzsScBC80KiOcFMngjOBBTnbvcVkl/R2c5OyUsqOOfoeTkN2DdOPy4hYnCRs6bOuC05C0JHPJOsFIL2tjjJwHMG/MxO5npJpFjNxecoSMZMecycpLJTilSKzezMxdyX6Y3qKkf/eH3E/OOdoPDQ9ifI+S2GNcxyhZ73U3SZLOU1JLB/0aM0Hg7Mzd/QvIL3z2MRVDErUlqdAKkkvenaOkQe9ljyAfU5JJ19ejQYm+wUgkD14Y7CXZx0Biex8jCQYZidy78RvDxA1GFqW87ZC2jPzr5Rc=\",\"2021-10-24T19:33:30.937Z\"]}]}"
        server.expect().withPath("/test")
            .andUpgradeToWebSocket()
            .open()
            .waitFor(0).andEmit(message)
            .done()
            .once()

        val element = repository.getDriverTelemetry(33).first()

        assertEquals(element!!.telemetry.speed, 219)
        assertEquals(element.telemetry.DRSValue, 0)
    }

    @Test
    fun getPositions() = runBlocking {
        val repository = LiveTimingRepository(service)
        val message =
            "{\"C\":\"d-BAF194C6-B,0|QI,0|QJ,11|BM,171|BT,155C|BS,155C|F,5|k,32D|Ml,0|BR,349|j,17B|h,5C|i,3|BO,57|BP,17|BJ,1|BV,16|f,12|BW,43F6\",\"M\":[{\"H\":\"Streaming\",\"M\":\"feed\",\"A\":[\"Position.z\",\"tZc/bxw5DMW/y9S7B/GfSG2fOgeci0sOVxhBCiOIE8R7lbHf/TQjcrIuVtIWbgws4AdKT48/cl6XP3+8PJ2ffjwvp39el4en719fzo/ffy6nBRPCEdIR+QHKiehE6Q8EZMb8eTksH57Pv56+viyn14XWP3+dH8//1Z/Lx+eHX49fvtV/+Xs5cUn5sHxaTkfOcFg+LyfgJJfDwrc1lA2bhpCxiQSsiuS26JiRm0glNw3aqsm3NWjUCmEBaRpiqhrt1EHidiNIgFEIq6jcFmUS2jRMWb1QhqqB1LGOU7sQiO6F8iqC2yIgsrLJaNNvhsum6jh+hJz9UoThXt5UHftMwe1jkXhbXUXWe6fi72TmgaC02ofYOx+oNZVAulZRxwss2EQE8VLEaRV1AgukSTaVFIbrUHDHQBBxAzNQ5BzXWtzJEhGiH1Dk+oDSCXo9n3cUIIYXWtakd6515ATtgU2LP3BZ+1B7WQdm8k5Mcm176YS9AqO0a1mEHU0vl8thzBeuHZ/M5vkiiTwYlHGaL/utIKAkKQ/4IibOF5vni7dw7VuY5gt7VxWxqMMDvICC44XLO+OlGt4iKxI55zFeLLVigHutbCO8GLl7vNacxIuoP1OJSjN4STnwstJpEi/mMae0k2wCL3FAsZJDBWO8aHG8RPom8II+dQj0TakuXgzBcwEQXhiM8CKpOF6YAy8wxAuReiOazuNFfNJbnK++xBxesiAplzvwAhEMzDSNlxTrS4oM8sbaLl7YrTCYx4v4/LXf842HeMktfyW96fqO41J8pWAifGe8ZGjpo5xjpSAZ4iUGPSAEMzWN8FK8O5Byvn7aLl62TedTQwZP86WIj+xs89uLZXa88Jvu7eOFGRwvkq6hNMCLNVVGKoEXGOEFTB0vJtN4KbwbCNHzRiO8ZHC8aJEI03h7QY/FkRXuwAs333Wfv5VkU3gxrR8HQHfgBWMZBgnfEw/wIlIcSSVWOd4c7OIluRXGMo0XbYfD3YkJvESh33Ngq9PDiyV1vOwDJ6f3wYtCa0TSiGz9mh3hBZMnAiDH7qw0wEtJGnjZv8MSjfBCRDF8RafxYuwDR7PO48WXYEpJ5/FC8XFkie/AiybHi92BFx/zFS97KRzgpS6IPka3kdDooiO6qC+aoPHFhzZeXsCzdBS5Z3nxqaOx09av1EqXfy//Aw==\",\"2021-10-24T19:33:30.872Z\"]}]}"
        server.expect().withPath("/test")
            .andUpgradeToWebSocket()
            .open()
            .waitFor(0).andEmit(message)
            .done()
            .once()

        val element = repository.getPositions().first()

        assertEquals(element.data!!.entries[0].cars[33]!!.xPosition, 13705.0F)
    }

    @Test
    fun getPreviousData() = runBlocking {
        val repository = LiveTimingRepository(service)
        val message = "{\"R\":{\"TimingAppData\":{\"Lines\":{\"11\":{\"RacingNumber\":\"11\",\"Line\":1,\"GridPos\":\"1\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"16\":{\"RacingNumber\":\"16\",\"Line\":2,\"GridPos\":\"2\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"55\":{\"RacingNumber\":\"55\",\"Line\":4,\"GridPos\":\"3\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"1\":{\"RacingNumber\":\"1\",\"Line\":3,\"GridPos\":\"4\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"31\":{\"RacingNumber\":\"31\",\"Line\":5,\"GridPos\":\"5\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"63\":{\"RacingNumber\":\"63\",\"Line\":6,\"GridPos\":\"6\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"14\":{\"RacingNumber\":\"14\",\"Line\":7,\"GridPos\":\"7\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"77\":{\"RacingNumber\":\"77\",\"Line\":8,\"GridPos\":\"8\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"10\":{\"RacingNumber\":\"10\",\"Line\":10,\"GridPos\":\"9\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"20\":{\"RacingNumber\":\"20\",\"Line\":9,\"GridPos\":\"10\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"HARD\",\"New\":\"false\",\"TyresNotChanged\":\"0\",\"TotalLaps\":2,\"StartLaps\":2}]},\"4\":{\"RacingNumber\":\"4\",\"Line\":11,\"GridPos\":\"11\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"24\":{\"RacingNumber\":\"24\",\"Line\":18,\"GridPos\":\"12\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"18\":{\"RacingNumber\":\"18\",\"Line\":12,\"GridPos\":\"13\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"false\",\"TyresNotChanged\":\"0\",\"TotalLaps\":1,\"StartLaps\":1}]},\"3\":{\"RacingNumber\":\"3\",\"Line\":13,\"GridPos\":\"14\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"44\":{\"RacingNumber\":\"44\",\"Line\":14,\"GridPos\":\"15\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"HARD\",\"New\":\"false\",\"TyresNotChanged\":\"0\",\"TotalLaps\":1,\"StartLaps\":1}]},\"23\":{\"RacingNumber\":\"23\",\"Line\":15,\"GridPos\":\"16\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"27\":{\"RacingNumber\":\"27\",\"Line\":16,\"GridPos\":\"17\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"HARD\",\"New\":\"false\",\"TyresNotChanged\":\"0\",\"TotalLaps\":1,\"StartLaps\":1}]},\"6\":{\"RacingNumber\":\"6\",\"Line\":17,\"GridPos\":\"18\",\"Stints\":[{\"LapFlags\":0,\"Compound\":\"MEDIUM\",\"New\":\"true\",\"TyresNotChanged\":\"0\",\"TotalLaps\":0,\"StartLaps\":0}]},\"22\":{\"RacingNumber\":\"22\",\"Line\":19,\"GridPos\":\"19\",\"Stints\":[]}},\"_kf\":true},\"WeatherData\":{\"AirTemp\":\"25.3\",\"Humidity\":\"58.0\",\"Pressure\":\"1012.5\",\"Rainfall\":\"0\",\"TrackTemp\":\"28.6\",\"WindDirection\":\"333\",\"WindSpeed\":\"2.5\",\"_kf\":true},\"DriverList\":{\"11\":{\"RacingNumber\":\"11\",\"BroadcastName\":\"S PEREZ\",\"FullName\":\"Sergio PEREZ\",\"Tla\":\"PER\",\"Line\":1,\"TeamName\":\"Red Bull Racing\",\"TeamColour\":\"1e5bc6\",\"FirstName\":\"Sergio\",\"LastName\":\"Perez\",\"Reference\":\"SERPER01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/S/SERPER01_Sergio_Perez/serper01.png.transform/1col/image.png\",\"CountryCode\":\"MEX\"},\"16\":{\"RacingNumber\":\"16\",\"BroadcastName\":\"C LECLERC\",\"FullName\":\"Charles LECLERC\",\"Tla\":\"LEC\",\"Line\":2,\"TeamName\":\"Ferrari\",\"TeamColour\":\"ed1c24\",\"FirstName\":\"Charles\",\"LastName\":\"Leclerc\",\"Reference\":\"CHALEC01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/C/CHALEC01_Charles_Leclerc/chalec01.png.transform/1col/image.png\",\"CountryCode\":\"MON\"},\"55\":{\"RacingNumber\":\"55\",\"BroadcastName\":\"C SAINZ\",\"FullName\":\"Carlos SAINZ\",\"Tla\":\"SAI\",\"Line\":4,\"TeamName\":\"Ferrari\",\"TeamColour\":\"ed1c24\",\"FirstName\":\"Carlos\",\"LastName\":\"Sainz\",\"Reference\":\"CARSAI01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/C/CARSAI01_Carlos_Sainz/carsai01.png.transform/1col/image.png\",\"CountryCode\":\"ESP\"},\"1\":{\"RacingNumber\":\"1\",\"BroadcastName\":\"M VERSTAPPEN\",\"FullName\":\"Max VERSTAPPEN\",\"Tla\":\"VER\",\"Line\":3,\"TeamName\":\"Red Bull Racing\",\"TeamColour\":\"1e5bc6\",\"FirstName\":\"Max\",\"LastName\":\"Verstappen\",\"Reference\":\"MAXVER01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/M/MAXVER01_Max_Verstappen/maxver01.png.transform/1col/image.png\",\"CountryCode\":\"NED\"},\"31\":{\"RacingNumber\":\"31\",\"BroadcastName\":\"E OCON\",\"FullName\":\"Esteban OCON\",\"Tla\":\"OCO\",\"Line\":5,\"TeamName\":\"Alpine\",\"TeamColour\":\"2293d1\",\"FirstName\":\"Esteban\",\"LastName\":\"Ocon\",\"Reference\":\"ESTOCO01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/E/ESTOCO01_Esteban_Ocon/estoco01.png.transform/1col/image.png\",\"CountryCode\":\"FRA\"},\"63\":{\"RacingNumber\":\"63\",\"BroadcastName\":\"G RUSSELL\",\"FullName\":\"George RUSSELL\",\"Tla\":\"RUS\",\"Line\":6,\"TeamName\":\"Mercedes\",\"TeamColour\":\"6cd3bf\",\"FirstName\":\"George\",\"LastName\":\"Russell\",\"Reference\":\"GEORUS01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/G/GEORUS01_George_Russell/georus01.png.transform/1col/image.png\",\"CountryCode\":\"GBR\"},\"14\":{\"RacingNumber\":\"14\",\"BroadcastName\":\"F ALONSO\",\"FullName\":\"Fernando ALONSO\",\"Tla\":\"ALO\",\"Line\":7,\"TeamName\":\"Alpine\",\"TeamColour\":\"2293d1\",\"FirstName\":\"Fernando\",\"LastName\":\"Alonso\",\"Reference\":\"FERALO01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/F/FERALO01_Fernando_Alonso/feralo01.png.transform/1col/image.png\",\"CountryCode\":\"ESP\"},\"77\":{\"RacingNumber\":\"77\",\"BroadcastName\":\"V BOTTAS\",\"FullName\":\"Valtteri BOTTAS\",\"Tla\":\"BOT\",\"Line\":8,\"TeamName\":\"Alfa Romeo\",\"TeamColour\":\"b12039\",\"FirstName\":\"Valtteri\",\"LastName\":\"Bottas\",\"Reference\":\"VALBOT01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/V/VALBOT01_Valtteri_Bottas/valbot01.png.transform/1col/image.png\",\"CountryCode\":\"FIN\"},\"10\":{\"RacingNumber\":\"10\",\"BroadcastName\":\"P GASLY\",\"FullName\":\"Pierre GASLY\",\"Tla\":\"GAS\",\"Line\":10,\"TeamName\":\"AlphaTauri\",\"TeamColour\":\"4e7c9b\",\"FirstName\":\"Pierre\",\"LastName\":\"Gasly\",\"Reference\":\"PIEGAS01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/P/PIEGAS01_Pierre_Gasly/piegas01.png.transform/1col/image.png\",\"CountryCode\":\"FRA\"},\"20\":{\"RacingNumber\":\"20\",\"BroadcastName\":\"K MAGNUSSEN\",\"FullName\":\"Kevin MAGNUSSEN\",\"Tla\":\"MAG\",\"Line\":9,\"TeamName\":\"Haas F1 Team\",\"TeamColour\":\"b6babd\",\"FirstName\":\"Kevin\",\"LastName\":\"Magnussen\",\"Reference\":\"KEVMAG01\",\"CountryCode\":\"DEN\"},\"4\":{\"RacingNumber\":\"4\",\"BroadcastName\":\"L NORRIS\",\"FullName\":\"Lando NORRIS\",\"Tla\":\"NOR\",\"Line\":11,\"TeamName\":\"McLaren\",\"TeamColour\":\"f58020\",\"FirstName\":\"Lando\",\"LastName\":\"Norris\",\"Reference\":\"LANNOR01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/L/LANNOR01_Lando_Norris/lannor01.png.transform/1col/image.png\",\"CountryCode\":\"GBR\"},\"24\":{\"RacingNumber\":\"24\",\"BroadcastName\":\"G ZHOU\",\"FullName\":\"ZHOU Guanyu\",\"Tla\":\"ZHO\",\"Line\":18,\"TeamName\":\"Alfa Romeo\",\"TeamColour\":\"b12039\",\"FirstName\":\"Guanyu\",\"LastName\":\"Zhou\",\"Reference\":\"GUAZHO01\",\"NameFormat\":\"LastNameIsPrimary\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/G/GUAZHO01_Guanyu_Zhou/guazho01.png.transform/1col/image.png\",\"CountryCode\":\"CHN\"},\"18\":{\"RacingNumber\":\"18\",\"BroadcastName\":\"L STROLL\",\"FullName\":\"Lance STROLL\",\"Tla\":\"STR\",\"Line\":12,\"TeamName\":\"Aston Martin\",\"TeamColour\":\"2d826d\",\"FirstName\":\"Lance\",\"LastName\":\"Stroll\",\"Reference\":\"LANSTR01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/L/LANSTR01_Lance_Stroll/lanstr01.png.transform/1col/image.png\",\"CountryCode\":\"CAN\"},\"3\":{\"RacingNumber\":\"3\",\"BroadcastName\":\"D RICCIARDO\",\"FullName\":\"Daniel RICCIARDO\",\"Tla\":\"RIC\",\"Line\":13,\"TeamName\":\"McLaren\",\"TeamColour\":\"f58020\",\"FirstName\":\"Daniel\",\"LastName\":\"Ricciardo\",\"Reference\":\"DANRIC01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/D/DANRIC01_Daniel_Ricciardo/danric01.png.transform/1col/image.png\",\"CountryCode\":\"AUS\"},\"44\":{\"RacingNumber\":\"44\",\"BroadcastName\":\"L HAMILTON\",\"FullName\":\"Lewis HAMILTON\",\"Tla\":\"HAM\",\"Line\":14,\"TeamName\":\"Mercedes\",\"TeamColour\":\"6cd3bf\",\"FirstName\":\"Lewis\",\"LastName\":\"Hamilton\",\"Reference\":\"LEWHAM01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/L/LEWHAM01_Lewis_Hamilton/lewham01.png.transform/1col/image.png\",\"CountryCode\":\"GBR\"},\"23\":{\"RacingNumber\":\"23\",\"BroadcastName\":\"A ALBON\",\"FullName\":\"Alexander ALBON\",\"Tla\":\"ALB\",\"Line\":15,\"TeamName\":\"Williams\",\"TeamColour\":\"37bedd\",\"FirstName\":\"Alexander\",\"LastName\":\"Albon\",\"Reference\":\"ALEALB01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/A/ALEALB01_Alexander_Albon/alealb01.png.transform/1col/image.png\",\"CountryCode\":\"THA\"},\"27\":{\"RacingNumber\":\"27\",\"BroadcastName\":\"N HULKENBERG\",\"FullName\":\"Nico HULKENBERG\",\"Tla\":\"HUL\",\"Line\":16,\"TeamName\":\"Aston Martin\",\"TeamColour\":\"2d826d\",\"FirstName\":\"Nico\",\"LastName\":\"Hulkenberg\",\"Reference\":\"NICHUL01\",\"CountryCode\":\"GER\"},\"6\":{\"RacingNumber\":\"6\",\"BroadcastName\":\"N LATIFI\",\"FullName\":\"Nicholas LATIFI\",\"Tla\":\"LAT\",\"Line\":17,\"TeamName\":\"Williams\",\"TeamColour\":\"37bedd\",\"FirstName\":\"Nicholas\",\"LastName\":\"Latifi\",\"Reference\":\"NICLAF01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/N/NICLAF01_Nicholas_Latifi/niclaf01.png.transform/1col/image.png\",\"CountryCode\":\"CAN\"},\"22\":{\"RacingNumber\":\"22\",\"BroadcastName\":\"Y TSUNODA\",\"FullName\":\"Yuki TSUNODA\",\"Tla\":\"TSU\",\"Line\":19,\"TeamName\":\"AlphaTauri\",\"TeamColour\":\"4e7c9b\",\"FirstName\":\"Yuki\",\"LastName\":\"Tsunoda\",\"Reference\":\"YUKTSU01\",\"HeadshotUrl\":\"https://www.formula1.com/content/dam/fom-website/drivers/Y/YUKTSU01_Yuki_Tsunoda/yuktsu01.png.transform/1col/image.png\",\"CountryCode\":\"JPN\"},\"_kf\":true},\"TimingData\":{\"Lines\":{\"11\":{\"GapToLeader\":\"LAP 1\",\"IntervalToPositionAhead\":{\"Value\":\"LAP 1\",\"Catching\":false},\"Line\":1,\"Position\":\"1\",\"ShowPosition\":true,\"RacingNumber\":\"11\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2051},{\"Status\":2049},{\"Status\":2051},{\"Status\":2051},{\"Status\":2051},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2051},{\"Status\":2051},{\"Status\":2051},{\"Status\":2049},{\"Status\":2051},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"281\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"16\":{\"GapToLeader\":\"+0.999\",\"IntervalToPositionAhead\":{\"Value\":\"+0.999\",\"Catching\":false},\"Line\":2,\"Position\":\"2\",\"ShowPosition\":true,\"RacingNumber\":\"16\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2051},{\"Status\":2051}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2051},{\"Status\":2049},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"277\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"55\":{\"GapToLeader\":\"+2.501\",\"IntervalToPositionAhead\":{\"Value\":\"+0.533\",\"Catching\":false},\"Line\":4,\"Position\":\"4\",\"ShowPosition\":true,\"RacingNumber\":\"55\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"273\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"1\":{\"GapToLeader\":\"+1.968\",\"IntervalToPositionAhead\":{\"Value\":\"+0.989\",\"Catching\":false},\"Line\":3,\"Position\":\"3\",\"ShowPosition\":true,\"RacingNumber\":\"1\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2051},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"281\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"31\":{\"GapToLeader\":\"+3.496\",\"IntervalToPositionAhead\":{\"Value\":\"+0.995\",\"Catching\":false},\"Line\":5,\"Position\":\"5\",\"ShowPosition\":true,\"RacingNumber\":\"31\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"279\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"63\":{\"GapToLeader\":\"+4.063\",\"IntervalToPositionAhead\":{\"Value\":\"+0.567\",\"Catching\":false},\"Line\":6,\"Position\":\"6\",\"ShowPosition\":true,\"RacingNumber\":\"63\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"280\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"14\":{\"GapToLeader\":\"+4.985\",\"IntervalToPositionAhead\":{\"Value\":\"+0.904\",\"Catching\":false},\"Line\":7,\"Position\":\"7\",\"ShowPosition\":true,\"RacingNumber\":\"14\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"279\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"77\":{\"GapToLeader\":\"+5.431\",\"IntervalToPositionAhead\":{\"Value\":\"+0.446\",\"Catching\":false},\"Line\":8,\"Position\":\"8\",\"ShowPosition\":true,\"RacingNumber\":\"77\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"274\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"10\":{\"GapToLeader\":\"+6.149\",\"IntervalToPositionAhead\":{\"Value\":\"+0.413\",\"Catching\":false},\"Line\":10,\"Position\":\"10\",\"ShowPosition\":true,\"RacingNumber\":\"10\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"273\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"20\":{\"GapToLeader\":\"+5.736\",\"IntervalToPositionAhead\":{\"Value\":\"+0.305\",\"Catching\":false},\"Line\":9,\"Position\":\"9\",\"ShowPosition\":true,\"RacingNumber\":\"20\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"280\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"4\":{\"GapToLeader\":\"+6.622\",\"IntervalToPositionAhead\":{\"Value\":\"+0.473\",\"Catching\":false},\"Line\":11,\"Position\":\"11\",\"ShowPosition\":true,\"RacingNumber\":\"4\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"279\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"24\":{\"GapToLeader\":\"+9.760\",\"IntervalToPositionAhead\":{\"Value\":\"+0.342\",\"Catching\":false},\"Line\":18,\"Position\":\"18\",\"ShowPosition\":true,\"RacingNumber\":\"24\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"272\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"18\":{\"GapToLeader\":\"+7.072\",\"IntervalToPositionAhead\":{\"Value\":\"+0.450\",\"Catching\":false},\"Line\":12,\"Position\":\"12\",\"ShowPosition\":true,\"RacingNumber\":\"18\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"280\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"3\":{\"GapToLeader\":\"+7.349\",\"IntervalToPositionAhead\":{\"Value\":\"+0.277\",\"Catching\":false},\"Line\":13,\"Position\":\"13\",\"ShowPosition\":true,\"RacingNumber\":\"3\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"275\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"44\":{\"GapToLeader\":\"+7.791\",\"IntervalToPositionAhead\":{\"Value\":\"+0.442\",\"Catching\":false},\"Line\":14,\"Position\":\"14\",\"ShowPosition\":true,\"RacingNumber\":\"44\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"283\",\"Status\":0,\"OverallFastest\":true,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"23\":{\"GapToLeader\":\"+8.256\",\"IntervalToPositionAhead\":{\"Value\":\"+0.465\",\"Catching\":false},\"Line\":15,\"Position\":\"15\",\"ShowPosition\":true,\"RacingNumber\":\"23\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"283\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"27\":{\"GapToLeader\":\"+8.849\",\"IntervalToPositionAhead\":{\"Value\":\"+0.593\",\"Catching\":false},\"Line\":16,\"Position\":\"16\",\"ShowPosition\":true,\"RacingNumber\":\"27\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2051},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"279\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"6\":{\"GapToLeader\":\"+9.418\",\"IntervalToPositionAhead\":{\"Value\":\"+0.569\",\"Catching\":false},\"Line\":17,\"Position\":\"17\",\"ShowPosition\":true,\"RacingNumber\":\"6\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2048},{\"Status\":2049},{\"Status\":2049},{\"Status\":2051},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":2049},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"281\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":true},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"22\":{\"GapToLeader\":\"\",\"IntervalToPositionAhead\":{\"Value\":\"\",\"Catching\":false},\"Line\":19,\"Position\":\"19\",\"ShowPosition\":true,\"RacingNumber\":\"22\",\"Retired\":false,\"InPit\":false,\"PitOut\":false,\"Stopped\":false,\"Status\":64,\"Sectors\":[{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":2064},{\"Status\":2064},{\"Status\":2064},{\"Status\":2048},{\"Status\":2048},{\"Status\":2048},{\"Status\":2052},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]},{\"Stopped\":false,\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false,\"Segments\":[{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0},{\"Status\":0}]}],\"Speeds\":{\"I1\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"I2\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"FL\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false},\"ST\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}},\"BestLapTime\":{\"Value\":\"\"},\"LastLapTime\":{\"Value\":\"\",\"Status\":0,\"OverallFastest\":false,\"PersonalFastest\":false}}},\"Withheld\":false,\"_kf\":true}},\"I\":\"0\"}"
        server.expect().withPath("/test")
            .andUpgradeToWebSocket()
            .open()
            .waitFor(0).andEmit(message)
            .done()
            .always()

        val element = repository.getPreviousData().first()

        assertEquals(element.drivers[1]!!.fullName, "Max VERSTAPPEN")
        assertEquals(element.timingAppDataDto!!.lapInfo[77]!!.position, 8)
        assertEquals(element.timingDataDto!!.lines[77]!!.position, 8)
        assertEquals(element.timingDataDto!!.lines[63]!!.interval!!.value, "+0.567")
    }
}
